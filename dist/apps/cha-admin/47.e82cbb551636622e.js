"use strict";(self.webpackChunkcha_admin=self.webpackChunkcha_admin||[]).push([[47],{2047:(Ye,C,i)=>{i.r(C),i.d(C,{ChaAdminTransactionsTableModule:()=>Le});var d=i(6895),f=i(433),c=i(8776),s=i(9653),u=i(4057),F=i(8235),_=i(2336),x=i(1740),v=i(5593),w=i(3214),U=i(1624),L=i(2675),S=i(5199),M=i(5621),Y=i(7240),e=i(4650);function B(t,n){if(1&t&&(e.TgZ(0,"div"),e._UZ(1,"formly-field",1),e.qZA()),2&t){const a=n.$implicit,o=n.index;e.xp6(1),e.Q6J("field",a),e.uIk("data-field-index-num-ele",o)}}let D=(()=>{class t extends u.hv{}return t.\u0275fac=function(){let n;return function(o){return(n||(n=e.n5z(t)))(o||t)}}(),t.\u0275cmp=e.Xpm({type:t,selectors:[["blade-repeating-type"]],standalone:!0,features:[e.qOj,e.jDz],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"field"]],template:function(a,o){1&a&&e.YNc(0,B,2,2,"div",0),2&a&&e.Q6J("ngForOf",o.field.fieldGroup)},dependencies:[d.ez,d.sg,f.UX,u.X0,u.cw],encapsulation:2,changeDetection:0}),t})();const T="[TRANSACTIONS TABLE]",l={get:(0,s.PH)(`${T} Get`),getSuccess:(0,s.PH)(`${T} Get Success`,(0,s.Ky)()),edit:(0,s.PH)(`${T} Edit`,(0,s.Ky)()),editSuccess:(0,s.PH)(`${T} Edit Success`),error:(0,s.PH)(`${T} Error`),reset:(0,s.PH)(`${T} Reset`)},$={trades:[],loading:!1,loaded:!1,saving:!1,saved:!1},V=(0,s.Lq)($,(0,s.on)(l.get,t=>({...t,loading:!0,loaded:!1})),(0,s.on)(l.getSuccess,(t,n)=>({...t,trades:n.trades,loading:!1,loaded:!0})),(0,s.on)(l.edit,t=>({...t,saving:!0,saved:!1})),(0,s.on)(l.editSuccess,t=>({...t,saving:!1,saved:!0})),(0,s.on)(l.error,l.reset,t=>$));function q(t,n){return V(t,n)}const g=(0,s.ZF)("transactions-table"),h={selectSaving:(0,s.P1)(g,t=>t.saving),selectSaved:(0,s.P1)(g,t=>t.saved),selectLoading:(0,s.P1)(g,t=>t.loading),selectLoaded:(0,s.P1)(g,t=>t.loaded),selectTrades:(0,s.P1)(g,t=>t.trades)};let b=(()=>{class t{constructor(a){this.store=a,this.isSaving$=this.store.select(h.selectSaving),this.isSaved$=this.store.select(h.selectSaved),this.loading$=this.store.select(h.selectLoading),this.loaded$=this.store.select(h.selectLoaded),this.trades$=this.store.select(h.selectTrades)}getTrades(){this.store.dispatch(l.get())}editTrade(a){this.store.dispatch(l.edit({trade:a}))}reset(){this.store.dispatch(l.reset())}}return t.\u0275fac=function(a){return new(a||t)(e.LFG(s.yh))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})();var Z=i(6129),y=i(4004),A=i(262),P=i(9646),de=i(4086),pe=i(8505),me=i(529);let fe=(()=>{class t{constructor(a,o){this._http=a,this.apiUrl=o}getTrades(){return this._http.get(`${this.apiUrl}/transactions`).pipe((0,y.U)(a=>a))}editTrade(a){return this._http.put(`${this.apiUrl}/transactions/trade/${a.id}`,a).pipe((0,y.U)(o=>o))}}return t.\u0275fac=function(a){return new(a||t)(e.LFG(me.eN),e.LFG("apiUrl"))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var O=i(805);let k=(()=>{class t{constructor(a,o,r,m){this.actions$=a,this.transactionsTableService=o,this.transactionsTableFacade=r,this.messageService=m,this.getAll$=(0,c.GW)(()=>this.actions$.pipe((0,c.l4)(l.get),(0,Z.z)(I=>this.transactionsTableService.getTrades().pipe((0,y.U)(Me=>l.getSuccess({trades:Me})),(0,A.K)(()=>(0,P.of)(l.error())))))),this.editTrade$=(0,c.GW)(()=>this.actions$.pipe((0,c.l4)(l.edit),(0,Z.z)(I=>this.transactionsTableService.editTrade(I.trade).pipe((0,y.U)(()=>l.editSuccess()),(0,A.K)(()=>(0,P.of)(l.error())))))),this.editTradeSuccess$=(0,c.GW)(()=>this.actions$.pipe((0,c.l4)(l.editSuccess),(0,de.g)(200),(0,pe.b)(()=>{this.messageService.add({severity:"success",summary:"Edit Trade Picks",detail:"Trade Picks are updated"}),this.transactionsTableFacade.getTrades()})),{dispatch:!1})}}return t.\u0275fac=function(a){return new(a||t)(e.LFG(c.eX),e.LFG(fe),e.LFG(b),e.LFG(O.ez))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})();var R=i(1779),Te=i(8417),ue=i(590),ge=i(4268),J=i(1889),Q=i(4984),N=i(655),G=i(9933),he=i(9300);let E=(()=>{class t{constructor(){this.form=new f.nJ({}),this.model={},this.options={}}ngOnInit(){this.trade&&this.patchForm(),this.createFields()}createFields(){this.fields=[{fieldGroupClassName:"w-full flex flex-wrap column-gap-2 row-gap-2",fieldGroup:[this.teamOneField()]},this.teamOnePicks(),{fieldGroupClassName:"w-full flex flex-wrap column-gap-2 row-gap-2",fieldGroup:[this.teamTwoField()]},this.teamTwoPicks()]}patchForm(){this.model={id:this.trade?.id,team_one_id:`${this.trade?.team_one_id.city} ${this.trade?.team_one_id.nickname}`,team_one_picks:this.trade?.team_one_picks.map(a=>({pick:a})),team_two_id:`${this.trade?.team_two_id.city} ${this.trade?.team_two_id.nickname}`,team_two_picks:this.trade?.team_two_picks.map(a=>({pick:a}))}}teamOneField(){return{key:"team_one_id",className:"w-full md:w-3",type:"text-input",templateOptions:{label:"Team",readonly:!0}}}teamTwoField(){return{key:"team_two_id",className:"w-full md:w-3",type:"text-input",templateOptions:{label:"Team",readonly:!0}}}teamOnePicks(){return{key:"team_one_picks",type:"repeating",fieldArray:{fieldGroup:[this.teamPickField()]}}}teamTwoPicks(){return{key:"team_two_picks",type:"repeating",fieldArray:{fieldGroup:[this.teamPickField()]}}}teamPickField(){return{key:"pick",type:"text-input",templateOptions:{label:"Pick"}}}}return t.\u0275fac=function(a){return new(a||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["cha-admin-transactions-table-edit-form"]],inputs:{trade:"trade"},decls:2,vars:5,consts:[[1,"w-full",3,"formGroup"],[3,"model","fields","options","form"]],template:function(a,o){1&a&&(e.TgZ(0,"form",0),e._UZ(1,"formly-form",1),e.qZA()),2&a&&(e.Q6J("formGroup",o.form),e.xp6(1),e.Q6J("model",o.model)("fields",o.fields)("options",o.options)("form",o.form))},dependencies:[f._Y,f.JL,f.sg,u.T7],encapsulation:2,changeDetection:0}),t})();var be=i(3186),_e=i(1185);let p=class{constructor(n){this.transactionsTableFacade=n,this.closeSidebar=new e.vpe}onCancel(){this.closeSidebar.emit(!0)}onSave(){const n={id:this.trade?.id,team_one_picks:this.getNewArray(this.tradeFormRef?.form.value.team_one_picks),team_two_picks:this.getNewArray(this.tradeFormRef?.form.value.team_two_picks)};console.log(n),this.transactionsTableFacade.editTrade(n),this.transactionsTableFacade.isSaving$.pipe((0,G.t)(this),(0,he.h)(a=>!a)).subscribe(()=>this.closeSidebar.emit(!0))}getNewArray(n){const a=[];return n.forEach(o=>{a.push(o.pick)}),a}};p.\u0275fac=function(n){return new(n||p)(e.Y36(b))},p.\u0275cmp=e.Xpm({type:p,selectors:[["cha-admin-transactions-table-edit"]],viewQuery:function(n,a){if(1&n&&e.Gf(E,5),2&n){let o;e.iGM(o=e.CRH())&&(a.tradeFormRef=o.first)}},inputs:{trade:"trade"},outputs:{closeSidebar:"closeSidebar"},decls:10,vars:3,consts:[[2,"background-color","var(--background-100)"],[1,"text-lg","font-light","text-center"],[3,"trade"],[1,"flex","justify-content-between"],[1,"flex","column-gap-1"],["pButton","","pRipple","","type","button",1,"p-button-raised",3,"label","disabled","click"],["pButton","","pRipple","","type","button","label","Cancel",1,"p-button-raised","p-button-warning",3,"click"]],template:function(n,a){1&n&&(e.TgZ(0,"blade-card",0)(1,"blade-card-header",1),e._uU(2," Edit Trade Picks "),e.qZA(),e.TgZ(3,"blade-card-body"),e._UZ(4,"cha-admin-transactions-table-edit-form",2),e.qZA(),e.TgZ(5,"blade-card-footer")(6,"div",3)(7,"div",4)(8,"button",5),e.NdJ("click",function(){return a.onSave()}),e.qZA(),e.TgZ(9,"button",6),e.NdJ("click",function(){return a.onCancel()}),e.qZA()()()()()),2&n&&(e.xp6(4),e.Q6J("trade",a.trade),e.xp6(4),e.Q6J("label","Save Trade")("disabled",(null==a.tradeFormRef||null==a.tradeFormRef.form?null:a.tradeFormRef.form.invalid)||!(null!=a.tradeFormRef&&null!=a.tradeFormRef.form&&a.tradeFormRef.form.dirty)))},dependencies:[v.Hq,J.A,Q.y,be.x,_e.n,E],encapsulation:2,changeDetection:0}),p=(0,N.gn)([(0,G.c)(),(0,N.w6)("design:paramtypes",[b])],p);const ye=["dt"];function ve(t,n){if(1&t){const a=e.EpF();e.TgZ(0,"div",6)(1,"span",7),e._UZ(2,"i",8),e.TgZ(3,"input",9),e.NdJ("input",function(r){e.CHM(a);const m=e.oxw();return e.KtG(m.applyFilterGlobal(r,"contains"))}),e.qZA()()()}}function Ce(t,n){if(1&t&&(e.TgZ(0,"th",11),e._uU(1),e._UZ(2,"p-sortIcon",12),e.qZA()),2&t){const a=n.$implicit;e.Q6J("pSortableColumn",a.field),e.xp6(1),e.hij(" ",a.header," "),e.xp6(1),e.Q6J("field",a.field)}}function Fe(t,n){if(1&t&&(e.TgZ(0,"tr"),e.YNc(1,Ce,3,3,"th",10),e.qZA()),2&t){const a=e.oxw();e.xp6(1),e.Q6J("ngForOf",a.tableColumns)}}function xe(t,n){if(1&t&&(e.ynx(0),e._uU(1),e.BQk()),2&t){const a=e.oxw().$implicit,o=e.oxw().$implicit,r=e.oxw();e.xp6(1),e.hij(" ",r.formatDate(o[a.field])," ")}}function we(t,n){if(1&t&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&t){const a=n.$implicit;e.xp6(1),e.Oqu(a)}}function Se(t,n){if(1&t&&(e.ynx(0),e.YNc(1,we,2,1,"div",13),e.BQk()),2&t){const a=e.oxw().$implicit,o=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",o[a.field])}}function $e(t,n){if(1&t&&(e.ynx(0),e._uU(1),e.BQk()),2&t){const a=e.oxw().$implicit,o=e.oxw().$implicit;e.xp6(1),e.hij(" ",o[a.field]," ")}}function Ze(t,n){if(1&t){const a=e.EpF();e.ynx(0),e.TgZ(1,"button",17),e.NdJ("click",function(){e.CHM(a);const r=e.oxw(2).$implicit,m=e.oxw();return e.KtG(m.onClick(r))}),e.qZA(),e.BQk()}}function Ae(t,n){if(1&t&&(e.TgZ(0,"td")(1,"span",14),e._uU(2),e.qZA(),e.TgZ(3,"div",15),e.YNc(4,xe,2,1,"ng-container",16),e.YNc(5,Se,2,1,"ng-container",16),e.YNc(6,$e,2,1,"ng-container",16),e.YNc(7,Ze,2,0,"ng-container",16),e.qZA()()),2&t){const a=n.$implicit;e.xp6(2),e.Oqu(a.header),e.xp6(2),e.Q6J("ngIf","transaction_date"===a.field),e.xp6(1),e.Q6J("ngIf","team_one_picks"===a.field||"team_two_picks"===a.field||"teamOnePlayers"===a.field||"teamTwoPlayers"===a.field),e.xp6(1),e.Q6J("ngIf","transaction_date"!==a.field&&"team_one_picks"!==a.field&&"team_two_picks"!==a.field&&"teamOnePlayers"!==a.field&&"teamTwoPlayers"!==a.field),e.xp6(1),e.Q6J("ngIf","action"===a.field)}}function Pe(t,n){if(1&t&&(e.TgZ(0,"tr"),e.YNc(1,Ae,8,5,"td",13),e.qZA()),2&t){const a=e.oxw();e.xp6(1),e.Q6J("ngForOf",a.tableColumns)}}function Oe(t,n){if(1&t){const a=e.EpF();e.TgZ(0,"p-sidebar",18),e.NdJ("visibleChange",function(r){e.CHM(a);const m=e.oxw();return e.KtG(m.display=r)}),e.TgZ(1,"cha-admin-transactions-table-edit",19),e.NdJ("closeSidebar",function(){e.CHM(a);const r=e.oxw();return e.KtG(r.onClose())}),e.qZA()()}if(2&t){const a=e.oxw();e.Q6J("visible",a.display)("fullScreen",!0)("showCloseIcon",!1)("dismissible",!1),e.xp6(1),e.Q6J("trade",a.trade)}}const ke=function(){return[10,20,25,50,100]},Re=function(){return["teamOne","teamTwo"]};let Je=(()=>{class t{constructor(){this.tableColumns=[{field:"id",header:"Trade Id"},{field:"transaction_date",header:"Date"},{field:"teamOne",header:"Team"},{field:"team_one_picks",header:"Picks"},{field:"teamOnePlayers",header:"Players"},{field:"teamTwo",header:"Team"},{field:"team_two_picks",header:"Picks"},{field:"teamTwoPlayers",header:"Players"},{field:"action",header:"Edit"}],this.first=0,this.rows=20,this.totalRecords=0,this.sortField="full_name",this.display=!1}ngOnInit(){this.tradesForTable=this.mapItems(this.trades)}applyFilterGlobal(a,o){this.dt?.filterGlobal(a.target.value,o)}mapItems(a){return a.map(o=>({...o,teamOne:`${o.team_one_id.city} ${o.team_one_id.nickname}`,teamTwo:`${o.team_two_id.city} ${o.team_two_id.nickname}`,teamOnePlayers:this.getString(o.team_one_players),teamTwoPlayers:this.getString(o.team_two_players)}))}getString(a){return a.map(o=>`${o.player?.firstname} ${o.player?.lastname}`)}onClick(a){this.trade=a,this.display=!0}onClose(){this.display=!1,this.trade=null}formatDate(a){return a.slice(0,10).replace(/-/g,"/")}}return t.\u0275fac=function(a){return new(a||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["cha-admin-transactions-table-table"]],viewQuery:function(a,o){if(1&a&&e.Gf(ye,5),2&a){let r;e.iGM(r=e.CRH())&&(o.dt=r.first)}},inputs:{isMobile:"isMobile",trades:"trades"},decls:6,vars:15,consts:[["styleClass","p-datatable-sm p-datatable-striped","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries",1,"table",3,"responsiveLayout","value","columns","rows","showCurrentPageReport","rowsPerPageOptions","paginator","totalRecords","sortField","sortOrder","filterDelay","globalFilterFields"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[3,"visible","fullScreen","showCloseIcon","dismissible","visibleChange",4,"ngIf"],[1,"flex","flex-wrap","justify-content-between"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Search Team",3,"input"],[3,"pSortableColumn",4,"ngFor","ngForOf"],[3,"pSortableColumn"],[3,"field"],[4,"ngFor","ngForOf"],[1,"p-column-title"],[1,"table-body-cell"],[4,"ngIf"],["pButton","","type","button","icon","pi pi-user-edit",1,"p-button-rounded","p-button-primary",3,"click"],[3,"visible","fullScreen","showCloseIcon","dismissible","visibleChange"],[3,"trade","closeSidebar"]],template:function(a,o){1&a&&(e.TgZ(0,"p-table",0,1),e.YNc(2,ve,4,0,"ng-template",2),e.YNc(3,Fe,2,1,"ng-template",3),e.YNc(4,Pe,2,1,"ng-template",4),e.qZA(),e.YNc(5,Oe,2,5,"p-sidebar",5)),2&a&&(e.Q6J("responsiveLayout","stack")("value",o.tradesForTable)("columns",o.tableColumns)("rows",o.rows)("showCurrentPageReport",!0)("rowsPerPageOptions",e.DdM(13,ke))("paginator",!0)("totalRecords",o.totalRecords)("sortField",o.sortField)("sortOrder",1)("filterDelay",0)("globalFilterFields",e.DdM(14,Re)),e.xp6(5),e.Q6J("ngIf",o.display))},dependencies:[d.sg,d.O5,_.iA,O.jx,_.lQ,_.fz,x.o,v.Hq,w.Y,p],encapsulation:2,changeDetection:0}),t})();const Qe=function(){return{height:"6px"}};function Ne(t,n){1&t&&e._UZ(0,"p-progressBar",4),2&t&&e.Akn(e.DdM(2,Qe))}function Ge(t,n){if(1&t&&(e.ynx(0),e._UZ(1,"cha-admin-transactions-table-table",5),e.BQk()),2&t){const a=n.ngIf,o=e.oxw(2);e.xp6(1),e.Q6J("isMobile",o.isMobile)("trades",a)}}function Ee(t,n){if(1&t&&(e.TgZ(0,"blade-card")(1,"blade-card-body"),e.YNc(2,Ge,2,2,"ng-container",3),e.ALo(3,"async"),e.qZA()()),2&t){const a=e.oxw();e.xp6(2),e.Q6J("ngIf",e.lcZ(3,1,a.trades$))}}const Ie=[{path:"",component:(()=>{class t{constructor(a,o){this.transactionsTableFacade=a,this.displayFacade=o,this.isLoaded$=this.transactionsTableFacade.loaded$,this.isLoading$=this.transactionsTableFacade.loading$,this.trades$=this.transactionsTableFacade.trades$,this.displayFacade.isMobile$.pipe((0,ue.P)()).subscribe(r=>{this.isMobile=r})}ngOnInit(){this.transactionsTableFacade.getTrades()}}return t.\u0275fac=function(a){return new(a||t)(e.Y36(b),e.Y36(Te.pC))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cha-admin-transaction-trades"]],decls:10,vars:6,consts:[[1,"pt-2"],[1,"text-lg","text-center",2,"font-weight","100"],["mode","indeterminate",3,"style",4,"ngIf"],[4,"ngIf"],["mode","indeterminate"],[3,"isMobile","trades"]],template:function(a,o){1&a&&(e.TgZ(0,"blade-layout-feature-content")(1,"div")(2,"div",0)(3,"div",1),e._uU(4,"Trades"),e.qZA()(),e._UZ(5,"blade-divider"),e.YNc(6,Ne,1,3,"p-progressBar",2),e.ALo(7,"async"),e.YNc(8,Ee,4,3,"blade-card",3),e.ALo(9,"async"),e.qZA()()),2&a&&(e.xp6(6),e.Q6J("ngIf",e.lcZ(7,2,o.isLoading$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(9,4,o.isLoaded$)))},dependencies:[d.O5,F.k,ge.R,S.C,J.A,Q.y,Je,d.Ov],encapsulation:2,changeDetection:0}),t})()}];let Ue=(()=>{class t{}return t.\u0275fac=function(a){return new(a||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[R.Bz.forChild(Ie),R.Bz]}),t})(),Le=(()=>{class t{}return t.\u0275fac=function(a){return new(a||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[k,b],imports:[d.ez,f.UX,Ue,F.q,_.U$,x.j,v.hJ,w.l,U.E,S.C,L.N,s.Aw.forFeature("transactions-table",q),c.sQ.forFeature([k]),u.X0.forRoot({wrappers:[{name:"control-wrapper",component:Y.t}],types:[{name:"text-input",component:M.T,wrappers:["control-wrapper"]},{name:"repeating",component:D}]})]}),t})()}}]);